#
# spec file for binutils package targetting freebsd
# 

%define _prefix @PREFIX@

%define binutils_version @BINUTILS_VERS@
%define binutils_rpmvers %{expand: %(echo @BINUTILS_VERS@ | tr - _)}

%define __os_install_post       %{nil}

Vendor:       RTEMS.org
Distribution: Linux
Name:         i386-freebsd5-binutils
Summary:      binutils for target i386-freebsd5
Group:        freebsd
Release:      @BINUTILS_RPMREL@
Summary:      binutils for i386-freebsd5
License:      GPL/LGPL
Packager:     	Ralf Corsepius <ralf_corsepius@rtems.org>
Prefix:		%{_prefix}
BuildRoot:	@RPM_BUILD_ROOT@

Version:      	%binutils_rpmvers
Source0:	ftp://ftp.gnu.org.com/pub/gnu/binutils/binutils-%{binutils_version}-20040411.tar.bz2
NoSource: 	0

# Urgh, but RH's find-* is too stupid to cope with foreign objects
# Autoreqprov:  	off

%description

Cross binutils for target freebsd

%prep
# untar the sources inside i386-freebsd5-binutils
%setup -c -n i386-freebsd5-binutils -a 0

%build
  test -d build || mkdir build
  cd build
  ../binutils-%{binutils_version}/configure --target=i386-freebsd5 \
    --disable-nls --disable-win32-registry \
    --verbose --prefix=%{prefix}

  make all

%install
  rm -rf $RPM_BUILD_ROOT
  cd build
  make prefix=$RPM_BUILD_ROOT%{prefix} install

# A bug in binutils: binutils does not install share/locale
# however it uses it
  ../binutils-%{binutils_version}/mkinstalldirs \
    $RPM_BUILD_ROOT%{prefix}/share/locale

# We don't want info files
  rm -rf $RPM_BUILD_ROOT%{prefix}/info

%files

%dir %{prefix}/man
%dir %{prefix}/man/man1
%doc %{prefix}/man/man1/i386-freebsd5*

# %dir %{prefix}/include
# %{prefix}/include/*.h

%exclude %{prefix}/lib

%dir %{prefix}/share
%dir %{prefix}/share/locale

%dir %{prefix}/bin
%{prefix}/bin/*

%dir %{prefix}/i386-freebsd5
%dir %{prefix}/i386-freebsd5/bin
%{prefix}/i386-freebsd5/bin/*

%dir %{prefix}/i386-freebsd5/lib
%{prefix}/i386-freebsd5/lib/ldscripts
