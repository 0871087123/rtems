#
# spec file for binutils package targetting cygwin
# 

%define binutils_version @BINUTILS_VERS@
%define binutils_rpmvers %{expand: %(echo @BINUTILS_VERS@ | tr - _)} 

Distribution: Linux
Name:         i686-pc-cygwin-binutils
Summary:      binutils for target i686-pc-cygwin
Group:        Cygwin
Release:      @BINUTILS_RPMREL@
Summary:      binutils for i686-pc-cygwin
License:      GPL/LGPL
Prefix:		%{_prefix}
BuildRoot:	@RPM_BUILD_ROOT@
BuildRequires:	bison

Version:      	%binutils_rpmvers
Source0:	ftp://cygwin.com/pub/cygwin/release/binutils/binutils-%{binutils_version}-src.tar.bz2
NoSource: 	0
%description

Cross binutils for target cygwin

%prep
# untar the sources inside i686-pc-cygwin-binutils
%setup -q -c -n i686-pc-cygwin-binutils -a 0

%build
  test -d build || mkdir build
  cd build
  ../binutils-%{binutils_version}/configure --target=i686-pc-cygwin \
    --disable-nls --without-included-gettext \
    --disable-win32-registry \
    --verbose \
    --prefix=%{_prefix} --mandir=%{_mandir} --infodir=%{_infodir} \
    --bindir=%{_bindir} --libdir=%{_libdir} --includedir=%{_includedir}

  make all

%install
  rm -rf $RPM_BUILD_ROOT
  cd build
  make DESTDIR=${RPM_BUILD_ROOT} install

# BUG: The info files don't get canonicalized
  rm -rf $RPM_BUILD_ROOT%{_infodir}

  rm -f $RPM_BUILD_ROOT%{prefix}/lib/libiberty.a

%clean
  rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%dir %{_mandir}
%dir %{_mandir}/man1
%doc %{_mandir}/man1/i686-pc-cygwin-*.1*

%{_bindir}/*

%dir %{_prefix}/i686-pc-cygwin
%dir %{_prefix}/i686-pc-cygwin/bin
%{_prefix}/i686-pc-cygwin/bin/*

%dir %{_prefix}/i686-pc-cygwin/lib
%{_prefix}/i686-pc-cygwin/lib/ldscripts
