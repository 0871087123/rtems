#
# spec file for package rtems
# 
# Copyright  (c)  1999  OARCorp, Huntsville, AL
#
# please send bugfixes or comments to joel@OARcorp.com
#

# neededforbuild -- nothing

Vendor:       OAR Corporation
Distribution: Linux
Name:         @target_alias@-gdb
Release:      @Release@
Copyright:    1999 OARCorp
Group:        unsorted
Provides:     @target_alias@-gdb

Autoreqprov:  on
Packager:     corsepiu@faw.uni-ulm.de and joel@OARcorp.com

Version:      gdb@gdb_version@
Summary:      gdb for target @target_alias@
Source0:      	gdb-@gdb_version@.tar.gz
Patch0:		gdb-@gdb_version@-rtems-@gdb_patch_version@.diff

Buildroot:    /tmp
# Patch:
%description
RTEMS is an open source operating system for embedded systems.

This is the GNU gdb for RTEMS targetting @target_alias@.

Authors:
--------
    Joel Sherrill (joel@oarcorp.com)
    ...

%prep
# untar the sources inside @target_alias@-gdb
%setup -c -n @target_alias@-gdb -a 0

%patch0 -p0

%build
test -d build || mkdir build
  cd build
  ../gdb-@gdb_version@/configure --target=@target_alias@ \
    --verbose --prefix=/opt/rtems 

  test -d $RPM_BUILD_ROOT/opt \
    || mkdir $RPM_BUILD_ROOT/opt
  test -d $RPM_BUILD_ROOT/opt/rtems \
    || mkdir $RPM_BUILD_ROOT/opt/rtems

  make all
  make info

%install
  cd build
  make prefix=$RPM_BUILD_ROOT/opt/rtems install
  make prefix=$RPM_BUILD_ROOT/opt/rtems install-info

%post
  if test -d $RPM_INSTALL_PREFIX/rtems/info;
  then
    rm -f $RPM_INSTALL_PREFIX/rtems/info/dir
    f=`find $RPM_INSTALL_PREFIX/rtems/info -name '*.info.gz'`
    test -n "$f" && for i in $f; do
      install-info $i $RPM_INSTALL_PREFIX/rtems/info/dir
    done
  fi

%postun
  if test -d $RPM_INSTALL_PREFIX/rtems/info;
  then
    rm -f $RPM_INSTALL_PREFIX/rtems/info/dir
    f=`find $RPM_INSTALL_PREFIX/rtems/info -name '*.info.gz'`
    test -n "$f" && for i in $f; do
      install-info $i $RPM_INSTALL_PREFIX/rtems/info/dir
    done
  fi

%files
%dir /opt/rtems/info
%doc /opt/rtems/info/gdb.info*
%doc /opt/rtems/info/mmalloc.info*
%doc /opt/rtems/info/readline.info*

%dir /opt/rtems/man
%dir /opt/rtems/man/man1
%doc /opt/rtems/man/man1/@target_alias@-gdb.1

%dir /opt/rtems/include
/opt/rtems/include/bfd.h
/opt/rtems/include/bfdlink.h

%dir /opt/rtems/lib
/opt/rtems/lib/libbfd*
/opt/rtems/lib/libiberty*

%dir /opt/rtems/bin
/opt/rtems/bin/@target_alias@-gdb

