Patch against RTEMS-ss-20030128
Author: Till Straumann <strauman@slac.stanford.edu>

2003/2/11

This patch addresses the following issues:
2003-02-20	Till Straumann <strauman@slac.stanford.edu>

	PR 349/bsps
	* src/mount.c, src/privateenv.c: 
  	    - mount() bugfix: allocated 'loc' node must be released if
			mount fails due to missing node_type_h
	    - silence compiler warning about improper pointer type

Index: cpukit/libcsupport/src/mount.c
===================================================================
RCS file: /afs/slac/g/spear/cvsrep/rtems/src-20030128/cpukit/libcsupport/src/mount.c,v
retrieving revision 1.1.1.2
diff -c -r1.1.1.2 mount.c
*** cpukit/libcsupport/src/mount.c	29 Jan 2003 22:57:19 -0000	1.1.1.2
--- cpukit/libcsupport/src/mount.c	7 Feb 2003 20:47:49 -0000
***************
*** 142,147 ****
--- 142,149 ----
              mount_point, RTEMS_LIBIO_PERMS_RWX, &loc, TRUE ) == -1 )
        goto cleanup_and_bail;
  
+     loc_to_free = &loc;
+ 
      /*
       * Test for node_type_h
       */
***************
*** 155,161 ****
       *  Test to see if it is a directory
       */
  
-     loc_to_free = &loc;
      if ( loc.ops->node_type_h( &loc ) != RTEMS_FILESYSTEM_DIRECTORY ) {
        errno = ENOTDIR; 
        goto cleanup_and_bail;
--- 157,162 ----
Index: cpukit/libcsupport/src/privateenv.c
===================================================================
RCS file: /afs/slac/g/spear/cvsrep/rtems/src-20030128/cpukit/libcsupport/src/privateenv.c,v
retrieving revision 1.1.1.3
diff -c -r1.1.1.3 privateenv.c
*** cpukit/libcsupport/src/privateenv.c	29 Jan 2003 22:57:20 -0000	1.1.1.3
--- cpukit/libcsupport/src/privateenv.c	30 Jan 2003 18:01:40 -0000
***************
*** 65,71 ****
     tmp->refcnt = 1;
  #endif
  
!    sc = rtems_task_variable_add(RTEMS_SELF,(void*)&rtems_current_user_env,free_user_env);
     if (sc != RTEMS_SUCCESSFUL) {
  	 /* don't use free_user_env because the pathlocs are
  	  * not initialized yet
--- 65,71 ----
     tmp->refcnt = 1;
  #endif
  
!    sc = rtems_task_variable_add(RTEMS_SELF,(void*)&rtems_current_user_env,(void(*)(void *))free_user_env);
     if (sc != RTEMS_SUCCESSFUL) {
  	 /* don't use free_user_env because the pathlocs are
  	  * not initialized yet
2003-02-20	Wolfram Wadepohl <W.Wadepohl@indumat.de>

	PR 357/rtems_misc
	* src/termios.c (rtems_termios_open):  Fixed code the incorrectly
	checked that the wrong pointer during allocation was NULL.

2003-02-11	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: AM_INIT_AUTOMAKE([1.7.2]).

2003-02-11	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: AC_PREREQ(2.57).

2003-02-06	Joel Sherrill <joel@OARcorp.com>

	* include/sys/ioccom.h: Include <sys/types.h> not <machine/types.h> so
	Linux port builds.

2003-02-05     Till Straumann  <strauman@slac.stanford.edu>

	PR 340/filesystem
	* src/fcntl.c: Add missing _fcntl_r assumed to exist by newlib.

2003-02-05	Joel Sherrill <joel@OARcorp.com>

	* include/sys/ioccom.h: Fix so not using internal RTEMS types in libc
	code.

2003-02-03	Joel Sherrill <joel@OARcorp.com>

	PR 338/filesystem
	* src/unixlibc.c: Side-effect of fixing reentrancy problem with 
	rtems_io_lookup_name() (API change).

2003-02-03     Till Straumann  <strauman@slac.stanford.edu>

	PR 339/filesystem
	* src/chroot.c: Fix violation of FS node object copy semantics.

2003-01-10	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* Makefile.am: Eliminate OBJS.

2003-01-10	Joel Sherrill <joel@OARcorp.com>

	* include/rtems/libio.h: Rename __dev_t to __rtems_dev_t to avoid
	conflict with GNU/Linux header files.

2003-01-03     Till Straumann  <strauman@slac.stanford.edu>

	* ChangeLog, base_fs.c, getpwent.c, privateenv.c 
	Per PR303, Fix violation of node_access copy syemantics 

2002-12-26     Till Straumann  <strauman@slac.stanford.edu

        * src/fchdir.c: PR302 fix violation of FS node object copy semantics.

2002-12-06	Joel Sherrill <joel@OARcorp.com>

	* src/malloc.c: Fixed code that incorrected did a disable dispatch
	instead of locking and unlocking the allocator mutex.

2002-12-06	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Add various checks to enhance portability.
	* src/termios.c: Reflect changes to configure.ac.

2002-12-02	Joel Sherrill <joel@OARcorp.com>

	* include/rtems/libio.h: Internally use a union of an unsigned64
	and major/minor device so we don't get into trouble shifting.
	The h8300 seemed to be impossible to remove warnings otherwise.
	Eventually the structure definition of a dev_t might be better anyway.
	* include/sys/ioccom.h: Added casts to remove warnings on 16 bit
	targets.

2002-11-19	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Cosmetical fixes.

2002-11-19	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Fix package name.

2002-11-18	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Check for sys/cdefs.h, Add NEED_SYS_CDEFS_H.
	Add check for CHAR_BIT.
	* Makefile.am: Conditionally install sys/cdefs.h iff using newlib or
	if the host does not provide sys/cdefs.h (Fixes Linux/posix).

2002-11-18	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Remove -ansi -fasm.
	Add checks to diagnose potential system header conflicts.
	* Makefile.am: Unconditionally install sys/cdefs.h.

2002-11-07      <strauman@slac.stanford.edu>

        * src/mount.c: Per PR297, correct fs_mountme failure paths.

2002-11-01	Joel Sherrill <joel@OARcorp.com>

	* ChangeLog: Corrected.

2002-10-30	Eric Norum <eric.norum@usask.ca>

	* src/printk.c: Add vprintk function for kernel printing
	from routines which have already obtained the va_list pointer.

2002-10-31	Joel Sherrill <joel@OARcorp.com>

	* src/mallocfreespace.c: Corrected sense of status check to 
	match change inside RTEMS.
	* src/newlibc.c: Removed warning.

2002-10-28	Joel Sherrill <joel@OARcorp.com>

	* include/rtems/libio.h: Change rtems_filesystem_node_types_t from
	enumeration to int to eliminate warnings when values are overridden.

2002-10-25	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Add nostdinc to AM_INIT_AUTOMAKE.

2002-10-24	<strauman@slac.stanford.edu>

	* src/eval.c: Per PR293, added freenode calls for evaluate
          link failures.

2002-10-23	<strauman@slac.stanford.edu>

	* src/mount.c per PR290, add check for ops->node_type_h
        * src/mknod.c per PR291, remove erroneous call to freenod

2002-10-21	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* .cvsignore: Reformat.
	Add autom4te*cache.
	Remove autom4te.cache.

2002-10-02	Eric Norum <eric.norum@usask.ca>

	* src/getpwent.c: Per PR283, reimplement to address reentrancy problems.
	* src/getgrent.c: Removed as functionality is now just a wrapper for 
	common routines in src/getpwent.c.
	* Makefile.am: Reflect file removal.

2002-09-14	Joel Sherrill <joel@OARcorp.com>

	* include/rtems/libio.h: Change rtems_filesystem_read_t and
	rtems_filesystem_write_t to return ssize_t to match read(2)
	and write(2) respectively.

2002-09-14	Eric Norum <eric.norum@usask.ca>

	* src/readdir_r.c: New file.
	* Makefile.am: Reflect above.

2002-08-12	Eric Norum <eric.norum@usask.ca>

	* src/write.c (_write_r): Change prototype to match newlib's reent.h.

2002-07-30	Joel Sherrill <joel@OARcorp.com>

	* include/sys/utime.h: Removed as file is now part of the RTEMS
	newlib support.
	* Makefile.am: Reflect above.
	* include/rtems/termiostypes.h: Avoid use of __P.

2002-07-22	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* Makefile.am: Use .$(OBJEXT) instead of .o.

2002-07-22	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* Makefile.am: Eliminate LIBNAME. Use AM_CPPFLAGS instead of
	INCLUDES (Upcoming automake standard).

2002-07-05	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: RTEMS_TOP(../..).

2002-07-01	Joel Sherrill <joel@OARcorp.com>

	* src/__times.c: Corrected from previous attempt to cleanup.

2002-07-01	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Remove RTEMS_PROJECT_ROOT.

2002-06-28	Joel Sherrill <joel@OARcorp.com>

	* src/__times.c: Cleaned up comments, return more information,
	and eliminated the fatal error on clock not set since it cannot
	occur.

2002-06-27	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* configure.ac: Use AC_CONFIG_AUX_DIR(../..).
	Add AC_PROG_RANLIB.

2002-06-17	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* Makefile.am: Merge src/Makefile.am.
	* configure.ac: Reflect changes above.
	* src/Makefile.am: Remove.

2002-06-17	Ralf Corsepius <corsepiu@faw.uni-ulm.de>

	* Makefile.am: Include $(top_srcdir)/../automake/*.am.
	Use ../aclocal.
	* src/Makefile.am: Include $(top_srcdir)/../automake/*.am.

2001-05-24	Joel Sherrill <joel@OARcorp.com>

	* src/.cvsignore: New file.

