#
# top level directory for RTEMS build tree
#
# Modified by Jiri to implement autoconf and cygnus one-tree build
#
#  $Id$
#

@SET_MAKE@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@
target = @target@
manext = 1
mandir = @mandir@/man$(manext)
program_prefix = @program_prefix@

export bindir

RTEMS_ROOT = @top_srcdir@
PROJECT_ROOT = @PROJECT_ROOT@

VPATH=@srcdir@

ifeq ($(RTEMS_BSP),)
  RTEMS_BSP = @RTEMS_BSP_LIST@
endif

include $(RTEMS_ROOT)/make/main.cfg

MTARGETS = all install $(TARGET_VARIANTS) $(TARGET_VARIANTS:%=%_all) \
  $(TARGET_VARIANTS:%=%_install) $(TARGET_VARIANTS:%=%_tests) \
  clean_wrapup distclean clean_dirs clean_tools tests clean depend

EXIT_CMD = exit 1

# Don't pass flags from previous make - especially NOT CFLAGS 
override MAKEFLAGS=

$(MTARGETS): 
	BASEDIR=`pwd`; \
	for bsp in $(RTEMS_BSP) xxx; \
	do if [ $$bsp != xxx ] ; then  \
	    cd $$BASEDIR; \
	    cmd="cd c; $(MAKE) RTEMS_BSP=$$bsp $(FLAGS_TO_PASS) \
            $@" ; \
	    eval $$cmd || $(EXIT_CMD); \
	fi; done; 
