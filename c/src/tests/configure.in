dnl Process this file with autoconf to produce a configure script.
dnl
dnl  $Id$

AC_PREREQ(2.13)
AC_INIT(libtests)
RTEMS_TOP(../../..)
AC_CONFIG_AUX_DIR(../../..)

AC_PROG_MAKE_SET
RTEMS_CANONICAL_TARGET_CPU

AM_MAINTAINER_MODE

RTEMS_ENABLE_MULTIPROCESSING
RTEMS_ENABLE_POSIX
RTEMS_ENABLE_NETWORKING
RTEMS_ENABLE_RDBG
RTEMS_ENABLE_INLINES
RTEMS_ENABLE_CXX
RTEMS_ENABLE_GCC28
RTEMS_ENABLE_LIBCDIR
RTEMS_ENABLE_BARE
dnl RTEMS_ENABLE_RTEMSBSP
RTEMS_ENABLE_TESTS

RTEMS_ENV_RTEMSBSP

dnl BEGIN configure.host.in

AC_PATH_PROG(RM,rm)
AC_PROG_INSTALL

dnl BEGIN configure.target.in

RTEMS_CHECK_CPU
RTEMS_CANONICAL_HOST

RTEMS_PROJECT_ROOT

dnl check target cc
RTEMS_PROG_CC_FOR_TARGET

dnl check for g++
if test "$RTEMS_HAS_CPLUSPLUS" = "yes"; then
  RTEMS_PROG_CXX_FOR_TARGET
fi

RTEMS_CANONICALIZE_TOOLS

dnl if this is an i386, does gas have good code16 support?
RTEMS_I386_GAS_CODE16

RTEMS_CHECK_SYSV_UNIX

RTEMS_CHECK_CUSTOM_BSP(RTEMS_BSP)

# always build the test tools
testtools_cfgdirs="tools/generic"
if test "$tests_enabled" = "yes"; then
   RTEMS_CHECK_MAKEFILE(libtests)
   RTEMS_CHECK_MAKEFILE(sptests)
   RTEMS_CHECK_MAKEFILE(tmtests)
   if test "$RTEMS_HAS_MULTIPROCESSING" = "yes"; then
       RTEMS_CHECK_MAKEFILE(mptests)
   fi
   if test "$RTEMS_HAS_POSIX_API" = "yes"; then
     RTEMS_CHECK_MAKEFILE(psxtests)
   fi
   if test -d "$srcdir/tools/$RTEMS_CPU"; then
     testtools_cfgdirs="$testtools_cfgdirs tools/$RTEMS_CPU"
   fi
fi 

AC_SUBST(rtems_cv_prog_cc_cross)
AC_SUBST(RTEMS_HAS_CPLUSPLUS)
AC_SUBST(RTEMS_USE_GCC272)
AC_SUBST(BARE_CPU_CFLAGS)
AC_SUBST(BARE_CPU_MODEL)
AC_SUBST(program_prefix)
AC_SUBST(CC_CFLAGS_DEFAULT)
AC_SUBST(CC_CFLAGS_DEBUG_V)
AC_SUBST(CC_CFLAGS_PROFILE_V)
AC_SUBST(CC_LDFLAGS_PROFILE_V)

AC_CONFIG_SUBDIRS($testtools_cfgdirs)

# Try to explicitly list a Makefile here
AC_OUTPUT( 
Makefile
support/Makefile
support/include/Makefile
support/stubdr/Makefile
support/wrapup/Makefile
tools/Makefile
samples/Makefile
samples/base_mp/Makefile
samples/base_mp/node1/Makefile
samples/base_mp/node2/Makefile
samples/base_sp/Makefile
samples/cdtest/Makefile
samples/hello/Makefile
samples/minimum/Makefile
samples/paranoia/Makefile
samples/ticker/Makefile
samples/unlimited/Makefile
$makefiles)
