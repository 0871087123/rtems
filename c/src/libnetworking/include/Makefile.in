#
#  $Id$
#

@SET_MAKE@
srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = ..
subdir = include

RTEMS_ROOT = @RTEMS_ROOT@
PROJECT_ROOT = @PROJECT_ROOT@

VPATH = @srcdir@

H_PIECES = bpfilter loop netdb opt_ipfw opt_mrouting opt_tcpdebug poll \
    resolv syslog
H_FILES = $(H_PIECES:%=$(srcdir)/../%.h)

SYS_H_PIECES = buf callout cdefs conf domain filio ioccom ioctl kernel \
    libkern malloc mbuf mount param proc protosw queue reboot resourcevar \
    rtprio select signalvar socket socketvar sockio sysctl syslimits syslog \
    systm ttycom ttydefaults ucred uio
SYS_H_FILES = $(SYS_H_PIECES:%=$(srcdir)/../sys/%.h)

RTEMS_H_PIECES = rtems_bsdnet rtems_bsdnet_internal tftp
RTEMS_H_FILES = $(RTEMS_H_PIECES:%=$(srcdir)/../rtems/%.h)

MACHINE_H_PIECES = conf cpu cpufunc endian in_cksum limits param types \
    vmparam
MACHINE_H_FILES = $(MACHINE_H_PIECES:%=$(srcdir)/../machine/%.h)

VM_H_PIECES = vm vm_extern vm_kern vm_param
VM_H_FILES = $(VM_H_PIECES:%=$(srcdir)/../vm/%.h)

NET_H_PIECES = bpf ethernet if if_arp if_dl if_llc if_types netisr radix \
    raw_cb route
NET_H_FILES = $(NET_H_PIECES:%=$(srcdir)/../net/%.h)

NETINET_H_PIECES = icmp_var if_ether igmp igmp_var in in_pcb in_systm in_var \
    ip ip_fw ip_icmp ip_mroute ip_var tcp tcp_debug tcp_fsm tcp_seq \
    tcp_timer tcp_var tcpip udp udp_var
NETINET_H_FILES = $(NETINET_H_PIECES:%=$(srcdir)/../netinet/%.h)

ARPA_H_PIECES = ftp inet nameser nameser_compat telnet
ARPA_H_FILES = $(ARPA_H_PIECES:%=$(srcdir)/../arpa/%.h)

NFS_H_PIECES = krpc nfs nfsdiskless nfsproto rpcv2 xdr_subs
NFS_H_FILES = $(NFS_H_PIECES:%=$(srcdir)/../nfs/%.h)

RTEMS_SERVERS_H_PIECES = ftpd
RTEMS_SERVERS_H_FILES = \
    $(RTEMS_SERVERS_H_PIECES:%=$(srcdir)/../rtems_servers/%.h)

SRCS = $(H_FILES) $(SYS_H_FILES) $(RTEMS_H_FILES) $(MACHINE_H_FILES) \
    $(VM_H_FILES) $(NET_H_FILES) $(NETINET_H_FILES) $(ARPA_H_FILES) \
    $(NFS_H_FILES) $(RTEMS_SERVERS_H_FILES)

RTEMS_WEBSERVER_H_PIECES= rtems_webserver
RTEMS_WEBSERVER_H_FILES=$(RTEMS_WEBSERVER_H_PIECES:%=$(srcdir)/../rtems_webserver/%.h)

include $(RTEMS_ROOT)/make/custom/@RTEMS_BSP@.cfg
include $(RTEMS_ROOT)/make/leaf.cfg

INSTALL_CHANGE = @INSTALL_CHANGE@
mkinstalldirs = $(SHELL) $(top_srcdir)/@RTEMS_TOPdir@/mkinstalldirs

INSTALLDIRS = $(PROJECT_INCLUDE) \
    $(PROJECT_INCLUDE)/sys $(PROJECT_INCLUDE)/machine \
    $(PROJECT_INCLUDE)/rtems $(PROJECT_INCLUDE)/vm \
    $(PROJECT_INCLUDE)/net $(PROJECT_INCLUDE)/netinet \
    $(PROJECT_INCLUDE)/arpa $(PROJECT_INCLUDE)/nfs

$(INSTALLDIRS):
	@$(mkinstalldirs) $(INSTALLDIRS)

CLEAN_ADDITIONS +=
CLOBBER_ADDITIONS +=

# We only make the install point for the networking header files if needed.

preinstall: $(INSTALLDIRS) $(SRCS)
	@$(INSTALL_CHANGE) -m 644 $(H_FILES) $(PROJECT_INCLUDE)
	@$(INSTALL_CHANGE) -m 644 $(SYS_H_FILES) $(PROJECT_INCLUDE)/sys
	@$(INSTALL_CHANGE) -m 644 $(RTEMS_H_FILES) $(PROJECT_INCLUDE)/rtems
	@$(INSTALL_CHANGE) -m 644 $(MACHINE_H_FILES) $(PROJECT_INCLUDE)/machine
	@$(INSTALL_CHANGE) -m 644 $(VM_H_FILES) $(PROJECT_INCLUDE)/vm
	@$(INSTALL_CHANGE) -m 644 $(NET_H_FILES) $(PROJECT_INCLUDE)/net
	@$(INSTALL_CHANGE) -m 644 $(NETINET_H_FILES) $(PROJECT_INCLUDE)/netinet
	@$(INSTALL_CHANGE) -m 644 $(ARPA_H_FILES) $(PROJECT_INCLUDE)/arpa
	@$(INSTALL_CHANGE) -m 644 $(NFS_H_FILES) $(PROJECT_INCLUDE)/nfs
	@$(INSTALL_CHANGE) -m 644 $(RTEMS_SERVERS_H_FILES) $(PROJECT_INCLUDE)
	@$(INSTALL_CHANGE) -m 644 $(RTEMS_WEBSERVER_H_FILES) $(PROJECT_INCLUDE)

all: preinstall

Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) \
	 && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
