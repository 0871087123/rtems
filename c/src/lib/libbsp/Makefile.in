#
#  $Id$
#

@SET_MAKE@
srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = .

RTEMS_ROOT = @RTEMS_ROOT@
PROJECT_ROOT = @PROJECT_ROOT@

VPATH = @srcdir@

include $(RTEMS_ROOT)/make/custom/@RTEMS_BSP@.cfg
include $(RTEMS_ROOT)/make/directory.cfg

INSTALL_CHANGE = @INSTALL_CHANGE@
mkinstalldirs = $(SHELL) $(top_srcdir)/@RTEMS_TOPdir@/mkinstalldirs

INSTALLDIRS = $(PROJECT_ROOT)/@RTEMS_BSP@/lib

$(INSTALLDIRS):
	@$(mkinstalldirs) $(INSTALLDIRS)

# shmdr is a portable shared memory MPCI layer
# We only build it if HAS_MP was defined
@HAS_MP_TRUE@MP_DRIVERS = shmdr

SUBDIRS = $(MP_DRIVERS)

# If we are building a "real" BSP, then we need to descend into the
# appropriate CPU specific directory.  The bare BSP is a special
# case which can be built for any CPU and it resides at the same
# level as the CPUs.  If we are building the bare BSP, then descend
# into that directory.

SUBDIRS += @RTEMS_LIBBSP_CPU_SUBDIR@

preinstall: 
	@$(mkinstalldirs) $(PROJECT_ROOT)/@RTEMS_BSP@/lib
	@if test "@RTEMS_BSP@" = "bare"; then \
	  $(INSTALL_CHANGE) -m 644 \
	    $(srcdir)/bare/bsp_specs \
	    $(PROJECT_ROOT)/@RTEMS_BSP@/lib; \
	else \
	  $(INSTALL_CHANGE) -m 644 \
	    $(srcdir)/$(RTEMS_CPU)/${RTEMS_BSP_FAMILY}/bsp_specs \
	    $(PROJECT_ROOT)/@RTEMS_BSP@/lib; \
	fi

Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) \
	 && CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status
